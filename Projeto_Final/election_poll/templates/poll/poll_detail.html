{% extends 'base.html' %}

{% block title %}Detalhes da Enquete{% endblock %}

{% block content %}
<h3 class="text-center mb-4 fw-bold display-5">{{ poll.question }}</h3>

<form id="vote-form" method="POST">
    {% csrf_token %}
    <div class="row">
        
        <div class="col-md-8">
            <div class="list-group">
                {% for option in poll.options.all %}
                <div class="form-check mb-2">
                    <input type="radio" name="option_id" value="{{ option.id }}" class="form-check-input" id="option{{ option.id }}">
                    <label class="form-check-label h4" for="option{{ option.id }}">
                        {{ option.option_text }}
                    </label>
                </div>
                {% endfor %}
            </div>
            
            <button type="submit" class="btn btn-success mt-3 w-100">Votar</button>
        </div>

      
        <div class="col-md-4 d-flex align-items-center">
            <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTbyrlLVHiFqdTvrIWm5m6t_x_jzuC-z6_rnw&s/400x300" 
                 alt="Imagem de Enquete" class="img-fluid rounded">
        </div>
    </div>
</form>



<div class="row mt-3">
    <div class="col-4">
        <a href="{% url 'poll_results' poll.id %}" class="btn btn-info w-50">Ver Resultados</a>
    </div>
    <div class="col-4">
        <a href="{% url 'delete_poll' poll.id %}" class="btn btn-danger w-50">Excluir Enquete</a>
    </div>
    <div class="col-4">
        <a href="/" class="btn btn-secondary w-50">Voltar</a>
    </div>
</div>

<script>
    $('#vote-form').on('submit', function(e) {
        e.preventDefault();
        $.ajax({
            type: 'POST',
            url: "{% url 'vote' poll.id %}",
            data: $(this).serialize(),
            success: function(response) {
                alert(response.message);
                window.location.href = "{% url 'poll_results' poll.id %}";
            },
            error: function(xhr, status, error) {
                alert(xhr.responseJSON.message || 'Erro ao registrar o voto.');
            }
        });
    });
</script>
{% endblock %}
